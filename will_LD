The goal of this analysis is to estimate LD across chromosome, using the new genomes and Nosil samples.
The samples have very low no of reads, but lets try anyway.



- Working folder:
/scratch/wally/FAC/FBM/DEE/tschwand/default/sfreitas/phylotim/tree_april_21

1) Map reads
2) Sort bam files
3) Call SNPs - VarScan2 (because I am not managing with FB)


To make a vcf file with the sample names (instead of sample1, sample2, etc) with mpileup:
```bash
ls *filtered.bam > order_samples
less order_samples 
sed -i 's/-filtered.bam//g' order_samples
```

```bash
screen -S will_SNPs
module load Bioinformatics/Software/vital-it
module load UHTS/Analysis/samtools/1.10
samtools mpileup -f Tps_LRv5b.fasta *filtered.bam > nosil_tps.mpileup
java -jar VarScan.v2.3.9.jar mpileup2snp nosil_Tps.mpileup  --min-reads2 5 --output-vcf 1 --vcf-sample-list order_samples > nosil_tps.vcf
```
I didnt save the names of the samples (to do so, see [here](https://www.biostars.org/p/94505/). So I need to check the order of bam files, which corresponds to the order in the vcf file.


After getting the vcf file, we will observe the no of reads per position:
```bash
module load UHTS/Analysis/GenomeAnalysisTK/4.1.3.0
GenomeAnalysisTK CreateSequenceDictionary --REFERENCE Tps_LRv5b.fasta
GenomeAnalysisTK VariantsToTable -R Tps_LRv5b.fasta -V nosil_tps.vcf -F CHROM -F POS -GF GT -GF DP --output Tps.nosil.DP.table
```
Got an error:
The provided VCF file is malformed at approximately line number 266519: Duplicate allele added to VariantContext: C, for input source: nosil_tps.vcf
This was because on this line:
```bash
sed -n 266519p nosil_tps.vcf
266519
```
there were more than one genotype (biallelic position)
So I removed all likes with commas:
```bash
awk -F '\t' '/^#/ {print;next;} {OFS="\t";R=$4;n=split($5,a,/[,]/);s="";for(i=1;i<=n;i++) {s=sprintf("%s%s%s%s",s,(i==1?"":","),a[i],a[i]==R?"AAAAAAAAA":"");} $5=s; print;}' nosil_tps.vcf > nosil_tps_withvirg.vcf
GenomeAnalysisTK VariantsToTable -R Tps_LRv5b.fasta -V nosil_tps_withvirg.vcf -F CHROM -F POS -GF GT -GF DP --output Tps.nosil.DP.table 
```


Download to my computer:
```bash
scp sfreitas1@axiom-front1.unil.ch:/scratch/axiom/FAC/FBM/DEE/tschwand/default/sfreitas/geneflow/05-mapping/Tms/call_old_and_new/sample_order /home/cravinhos/Dropbox/Timema_cryptic_geneflow/2_from_reads_to_vcf/monikensis/Tms_all_varscan
scp sfreitas1@axiom-front1.unil.ch:/scratch/axiom/FAC/FBM/DEE/tschwand/default/sfreitas/geneflow/05-mapping/Tms/call_old_and_new/all_Tms.vcf /home/cravinhos/Dropbox/Timema_cryptic_geneflow/2_from_reads_to_vcf/monikensis/Tms_all_varscan
```



